# 跨平台编译运行

## 涉及镜像
tonistiigi/binfmt

lcr.loongnix.cn/library/binfmt

multiarch/qemu-user-static

lcr.loongnix.cn/library/qemu-user-static

## x86仿真运行编译LA
1. binfmt
    - 获取lcr.loongnix.cn/library/binfmt:x86_add_loongarch
    ``` docker pull lcr.loongnix.cn/library/binfmt:x86_add_loongarch```
    - 将qemu-loongarch64注册码注册到/proc/sys/fs/binfmt_misc下，qemu-loongarch64存入缓存
    ``` docker run --rm --privileged lcr.loongnix.cn/library/binfmt:x86_add_loongarch --install loongarch64```
    - 拉取LA镜像，如
    ``` docker pull --platform=linux/loong64 lcr.loongnix.cn/library/alpine:latest```
    - 编译运行时需指定LA架构，如
    ``` docker buildx build --platform linux/loong64 -t example:example -f example . ```
2. qemu-user-static
    - 获取multiarch/qemu-user-static:latest qemu-loongarch二进制
    ```
    docker pull multiarch/qemu-user-static:latest
    wget https://github.com/multiarch/qemu-user-static/releases/download/v7.2.0-1/qemu-loongarch64-static
    ```
    - 将qemu-loongarch64注册码注册到/proc/sys/fs/binfmt_misc下, 手动下载qemu-loongarch64 并放置到/usr/bin
    ```
    docker run --rm -it --privileged multiarch/qemu-user-static:latest
    mv qemu-loongarch64-static /usr/bin/qemu-loongarch64-static
    ```
    - 拉取LA镜像，如
    ``` docker pull --platform=linux/loong64 lcr.loongnix.cn/library/alpine:latest```
    - 编译运行时需指定LA架构，如
    ``` docker buildx build --platform linux/loong64 -t example:example -f example . ```

## LA仿真运行编译x86
1. binfmt
    - 同x86方式相同，使用镜像不同
    ``` docker pull lcr.loongnix.cn/library/binfmt:latest ```
2. qemu-user-static
    - 同x86方式相同，使用镜像不同
    ``` docker pull lcr.loongnix.cn/library/qemu-user-static:latest ```
    - 全部架构的qemu-static二进制tar包地址
    ``` https://github.com/Loongson-Cloud-Community/qemu-user-static/releases/download/abi2.0/qemu-static-8.2.0-rc2.tar.gz```